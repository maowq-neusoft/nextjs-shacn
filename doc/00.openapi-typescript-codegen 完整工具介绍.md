# openapi-typescript-codegen 完整工具介绍
openapi-typescript-codegen 是一款**基于 OpenAPI 规范（2.x/3.x）自动生成 TypeScript 类型安全 API 代码**的工具，核心价值是“消除重复接口封装、保证前后端类型一致”，支持多 HTTP 客户端、多模块系统，适配前端（React/Vue/Next.js）和后端（Node.js/NestJS）全场景，是现代化 TypeScript 项目对接 OpenAPI 接口的核心工具。

## 一、核心定位与优势
### 核心定位
- 输入：OpenAPI 规范文件（本地 YAML/JSON 文件或远程 URL）；
- 输出：可直接在项目中使用的 TypeScript 代码（含接口函数、数据模型、请求底层封装）；
- 目标：让开发者无需手动编写接口调用函数和类型定义，通过工具生成“即插即用”的 API 层，同时保证类型安全（避免类型不匹配、字段缺失等问题）。

### 核心优势
1. **类型完全自动同步**：生成的类型定义与 OpenAPI 规范 1:1 对应，后端更新接口后，重新生成即可同步类型，无需手动维护；
2. **多客户端/框架适配**：支持 Axios、Fetch、React Query、Vue Query、NestJS 等 10+ 种客户端/框架，灵活适配不同技术栈；
3. **零侵入集成**：生成的代码无额外依赖（除选择的 HTTP 客户端外），可直接集成到现有项目；
4. **高度可配置**：支持接口筛选、代码压缩、模块系统切换（ESM/CJS）、自定义模板等，适配不同项目需求；
5. **生产级稳定**：开源多年（GitHub 2.5k+ Star），支持 OpenAPI 2.x/3.x 全规范，无兼容性问题。

## 二、核心功能与支持范围
### 1. 基础功能
- 自动生成**接口函数**：按 OpenAPI 中的 `paths` 生成对应 CRUD 函数（如 `getPetById`、`createPet`）；
- 自动生成**数据模型**：按 OpenAPI 中的 `schemas` 生成 TypeScript 接口（`interface`）、枚举（`enum`），支持联合类型、继承等；
- 自动生成**请求底层**：封装 HTTP 客户端调用逻辑（如 Axios 实例、请求拦截、错误处理），无需手动封装；
- 自动处理**接口细节**：路径参数替换（如 `{petId}` 自动映射为函数参数）、查询参数序列化、请求体类型校验。

### 2. 支持范围
| 支持项                | 详情                                                                 |
|-----------------------|----------------------------------------------------------------------|
| OpenAPI 版本          | 2.0（Swagger）、3.0.x、3.1.x 全版本                                  |
| HTTP 客户端           | Axios、Fetch（原生）、Node.js 原生 HTTP、React Query、Vue Query 等 12+ 种 |
| 模块系统              | ESM（默认）、CommonJS（CJS）                                         |
| 代码优化              | 代码压缩（`--minify`）、接口筛选（`--include`/`--exclude`）、类型分离 |
| 自定义能力            | 自定义模板、自定义请求函数、自定义全局配置（BASE_URL/TOKEN 等）       |
| 兼容场景              | 前端（React/Vue/Next.js/Svelte）、后端（Node.js/NestJS）、SDK 开发    |

## 三、安装与基础使用
### 1. 安装方式
无需全局安装，推荐用 `npx` 直接运行（避免版本冲突）：
```bash
# 临时运行（推荐）
npx openapi-typescript-codegen@latest [参数]

# 本地安装（频繁使用时）
npm install -D openapi-typescript-codegen
# 或 yarn
yarn add -D openapi-typescript-codegen
```

### 2. 基础命令格式
```bash
npx openapi-typescript-codegen \
  --input <OpenAPI 配置路径/URL> \  # 必选：本地文件（如 ./api/swagger.yaml）或远程 URL
  --output <输出目录> \             # 必选：如 ./src/api/generated
  --client <HTTP 客户端> \          # 必选：如 axios、fetch、react-query
  [其他可选参数]
```

### 3. 快速示例（Axios 客户端）
```bash
# 从远程 OpenAPI 生成 Axios 客户端代码
npx openapi-typescript-codegen@latest \
  --input https://petstore.swagger.io/v2/swagger.json \
  --output ./src/api/generated \
  --client axios
```

## 四、生成代码结构解析
生成的代码按“底层核心 + 业务层”拆分，结构清晰，无需修改即可使用：
```
src/api/generated/
├── core/                # 底层核心模块（请求封装、配置）
│   ├── axios.ts         # Axios 实例配置（超时、默认 headers）
│   ├── OpenAPI.ts       # 全局配置（BASE_URL、TOKEN、跨域等，可手动修改）
│   └── request.ts       # 核心请求函数（发起请求、错误处理）
├── models/              # 数据模型模块（TypeScript 类型定义）
│   ├── Pet.ts           # 实体类类型（如 Pet 接口、StatusEnum 枚举）
│   └── ...              # 其他实体类型
└── api/                 # 业务接口模块（按 OpenAPI 标签拆分）
    ├── pet.ts           # 宠物相关接口（如 getPetById、findPetsByStatus）
    ├── store.ts         # 商店相关接口
    └── user.ts          # 用户相关接口
```

### 各模块核心作用
1. **core/**：负责“怎么请求”，封装底层逻辑，无需修改，仅需按需配置 `OpenAPI.ts`；
2. **models/**：负责“数据类型”，所有接口的请求体、响应体类型都在这里，保证类型安全；
3. **api/**：负责“请求什么”，按业务模块拆分的接口函数，直接导入调用即可。

## 五、关键参数详解（高频常用）
| 参数                | 作用                                  | 常用值                          |
|---------------------|---------------------------------------|---------------------------------|
| `--input`           | 指定 OpenAPI 配置来源                  | ./api/swagger.yaml、远程 URL    |
| `--output`          | 指定代码输出目录                      | ./src/api/generated             |
| `--client`          | 选择 HTTP 客户端                      | axios（通用）、fetch（零依赖）、react-query（React 缓存） |
| `--module`          | 切换模块系统                          | esm（默认，适配现代前端）、cjs（Node.js 后端） |
| `--minify`          | 压缩生成的代码（减小体积）            | 无值（开关参数，加则生效）      |
| `--include`         | 只保留匹配的接口（正则）              | ".*pet.*"（只保留宠物相关接口） |
| `--exclude`         | 排除匹配的接口（正则）                | ".*user.*"（排除用户相关接口）  |
| `--base-url`        | 自定义接口基础 URL（覆盖 OpenAPI 配置）| https://your-backend.com/api    |

## 六、不同场景适配方案
### 1. 前端通用场景（React/Vue）
- 客户端选择：`axios`（支持拦截器、取消请求）；
- 命令示例：
  ```bash
  npx openapi-typescript-codegen@latest \
    --input ./api/swagger.yaml \
    --output ./src/api/generated \
    --client axios \
    --module esm \
    --minify
  ```
- 核心优势：类型安全、支持拦截器（如请求前加 Token）。

### 2. React 缓存场景（需要状态管理）
- 客户端选择：`react-query`（自带缓存、加载状态、重试逻辑）；
- 命令示例：
  ```bash
  npx openapi-typescript-codegen@latest \
    --input ./api/swagger.yaml \
    --output ./src/api/generated \
    --client react-query \
    --module esm
  ```
- 核心优势：生成 `useQuery`/`useMutation` 钩子，无需手动封装缓存逻辑。

### 3. 零依赖场景（拒绝第三方客户端）
- 客户端选择：`fetch`（浏览器原生，无额外依赖）；
- 命令示例：
  ```bash
  npx openapi-typescript-codegen@latest \
    --input ./api/swagger.yaml \
    --output ./src/api/generated \
    --client fetch \
    --module esm
  ```
- 核心优势：减小打包体积，适配纯 HTML/JS 或轻量项目。

### 4. Node.js/后端场景
- 客户端选择：`node`（Node.js 原生 HTTP 模块，无依赖）；
- 命令示例：
  ```bash
  npx openapi-typescript-codegen@latest \
    --input ./api/swagger.yaml \
    --output ./src/sdk \
    --client node \
    --module cjs
  ```
- 核心优势：适配 Node.js 后端/SDK 开发，支持流式响应、代理配置。

## 七、常见问题与避坑指南
1. **参数报错（unknown option）**：
   - 原因：版本不匹配（新版移除了旧参数，如 `--with-comments`）或安装了同名工具；
   - 解决：指定明确版本（如 `@0.29.0`），或运行 `npx openapi-typescript-codegen --help` 查看当前版本支持的参数。

2. **npm 404/ETARGET 错误**：
   - 原因：包名错误或版本号不存在；
   - 解决：使用官方包名 `openapi-typescript-codegen`，指定真实存在的版本（如 `@0.29.0`）。

3. **生成的代码无注释/无法关闭注释**：
   - 原因：新版（v0.29.0+）简化了注释逻辑，默认生成所有注释，无关闭参数；
   - 解决：需关闭注释则降级到 v2.12.0 并加 `--no-comments`，或生成后手动批量删除。

4. **类型不匹配**：
   - 原因：OpenAPI 规范中 `schemas` 定义不完整或类型错误；
   - 解决：检查 OpenAPI 配置的 `description` 和 `type` 定义，确保字段类型准确。

## 八、工具对比（vs 其他同类工具）
| 工具                          | 优势                                  | 劣势                                  |
|-------------------------------|---------------------------------------|---------------------------------------|
| openapi-typescript-codegen    | 多客户端支持、配置灵活、全规范兼容    | 新版注释参数简化，部分场景需手动适配  |
| swagger-typescript-api        | 支持更多自定义配置、注释更详细        | 客户端支持较少，体积略大              |
| openapi-typescript（微软）    | 轻量、仅生成类型定义                  | 不生成接口函数，需手动封装请求        |


## 总结
openapi-typescript-codegen 是 TypeScript 项目对接 OpenAPI 接口的“瑞士军刀”——支持多场景、类型安全、零侵入集成，核心价值是“解放重复劳动、保证前后端类型一致”。

使用流程可总结为：
1. 获取后端提供的 OpenAPI 规范文件（YAML/JSON）；
2. 用工具生成代码（指定输入、输出、客户端）；
3. 直接导入 `api` 中的函数调用，按需配置 `core/OpenAPI.ts`；
4. 后端接口更新后，重新生成代码即可同步。

要不要我帮你生成一份 **项目专属的配置脚本**，比如“Next.js + Axios + 自定义 BASE_URL + 接口筛选”的一键生成命令？


| 客户端选项       | 适用场景                                  |
|------------------|-------------------------------------------|
| axios            | 前端（React/Vue/Next.js）、Node.js 后端，需拦截器/取消请求/FormData |
| fetch            | 前端零依赖场景、纯 HTML/JS、轻量项目，追求小打包体积 |
| node             | Node.js 后端、SDK 开发，服务端调用第三方 API |
| xhr              | 旧项目兼容（如 IE 11），不推荐新项目使用    |
| angular          | Angular 2+ 项目，需与框架依赖注入/拦截器整合 |
| nestjs           | NestJS 后端项目，需生成可注入的 API 服务类  |
| react-query      | React 项目，需请求缓存/加载状态/重试逻辑    |
| vue-query        | Vue 3+ 项目（Composition API），需响应式请求缓存 |
| svelte-query     | Svelte 3+ 项目，需响应式请求状态管理        |
| solid-query      | SolidJS 项目，需响应式请求状态管理          |
| graphql          | GraphQL 项目，需对接 OpenAPI 格式第三方接口 |
| urql             | GraphQL 项目（使用 urql 客户端），对接 OpenAPI 接口（实验性） |
| custom           | 需自定义请求逻辑（特殊签名/私有协议/复杂多环境） |