# openapi-generator 完整用法指南
openapi-generator 是一款**多语言全能型 OpenAPI 代码生成工具**（支持 30+ 编程语言），核心优势是“全场景覆盖”——可生成客户端代码、服务端存根、API 文档、配置文件等，适配多语言协作的大型项目。以下是其核心用法（重点聚焦 TypeScript/前端常用场景）：

## 一、前置准备
### 1. 安装方式（3种，推荐第1种）
#### 方式1：使用 npm 包（前端项目首选，无需 Java 环境）
```bash
# 本地安装（推荐）
npm install -D @openapitools/openapi-generator-cli
# 或全局安装
npm install -g @openapitools/openapi-generator-cli
```

#### 方式2：使用 JAR 包（需 Java 8+ 环境，功能最完整）
1. 下载最新 JAR 包：https://github.com/OpenAPITools/openapi-generator/releases
2. 运行命令（替换 JAR 包路径和参数）：
```bash
java -jar openapi-generator-cli-7.8.0.jar generate [参数]
```

#### 方式3：Docker 容器（无环境依赖，适合 CI/CD）
```bash
docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli generate [参数]
```

### 2. 验证安装成功
```bash
# npm 方式
openapi-generator-cli version
# JAR 方式
java -jar openapi-generator-cli-7.8.0.jar version
# Docker 方式
docker run --rm openapitools/openapi-generator-cli version
```
输出版本号（如 `7.8.0`）即表示安装成功。

## 二、核心命令格式
```bash
openapi-generator-cli generate \
  -i <OpenAPI 配置路径/URL> \  # 必选：本地文件（./swagger.yaml）或远程 URL
  -g <生成器类型> \             # 必选：指定语言/框架（如 typescript-axios）
  -o <输出目录> \               # 必选：如 ./src/api/generated
  [其他可选参数]                # 如自定义模板、配置文件等
```

## 三、前端常用生成器（`-g` 参数值）
openapi-generator 的 TypeScript/前端相关生成器（按需选择）：
| 生成器类型               | 核心功能                                  | 适用场景                          |
|--------------------------|-------------------------------------------|-----------------------------------|
| `typescript-axios`       | 生成 TypeScript + Axios 客户端（最常用）  | React/Vue/Next.js 前端项目        |
| `typescript-fetch`       | 生成 TypeScript + 原生 Fetch 客户端       | 零依赖前端项目                    |
| `typescript-react-query` | 生成 React Query 钩子（useQuery/useMutation） | React 项目（需请求缓存）          |
| `angular`                | 生成 Angular 服务类（适配 Angular 2+）    | Angular 项目                      |
| `typescript-node`        | 生成 Node.js 客户端（适配后端/SDK）        | Node.js 后端/SDK 开发             |

## 四、高频使用示例（前端重点）
### 示例1：生成 TypeScript + Axios 客户端（最常用）
```bash
openapi-generator-cli generate \
  -i https://petstore.swagger.io/v2/swagger.json \  # 远程 OpenAPI 配置
  -g typescript-axios \                             # 生成器类型：TS + Axios
  -o ./src/api/generated-openapi \                   # 输出目录
  --additional-properties=modelPackage=models,apiPackage=api,moduleName=apiClient \  # 自定义包名
  --enable-post-process-file \                       # 启用文件后处理（可选）
  --skip-validate-spec                               # 跳过 OpenAPI 规范校验（适配不标准的配置）
```
### 实际执行单行
```bash
npx @openapitools/openapi-generator-cli generate -i https://petstore.swagger.io/v2/swagger.json -g typescript-axios -o ./src/api/generated-openapi --additional-properties=modelPackage=models,apiPackage=api,moduleName=apiClient --enable-post-process-file --skip-validate-spec
```
### 实际执行多行
```bash
npx @openapitools/openapi-generator-cli generate \
-i https://petstore.swagger.io/v2/swagger.json \
-g typescript-axios \
-o ./src/api/generated-openapi/axios/ \
--additional-properties=modelPackage=models,apiPackage=api,moduleName=apiClient \
--enable-post-process-file \
--skip-validate-spec
```

```bash
npx @openapitools/openapi-generator-cli generate \
-i https://petstore.swagger.io/v2/swagger.json \
-g typescript-redux-query \
-o ./src/api/generated-openapi/redux-query/ \
--additional-properties=modelPackage=models,apiPackage=api,moduleName=apiClient \
--enable-post-process-file \
--skip-validate-spec
```

```bash
npx @openapitools/openapi-generator-cli generate \
-i https://petstore.swagger.io/v2/swagger.json \
-g typescript-fetch \
-o ./src/api/generated-openapi/fetch/ \
--additional-properties=modelPackage=models,apiPackage=api,moduleName=apiClient \
--enable-post-process-file \
--skip-validate-spec
```

```bash
npx @openapitools/openapi-generator-cli generate \
-i https://petstore.swagger.io/v2/swagger.json \
-g typescript-jquery \
-o ./src/api/generated-openapi/jquery/ \
--additional-properties=modelPackage=models,apiPackage=api,moduleName=apiClient \
--enable-post-process-file \
--skip-validate-spec
```
### 关闭注释
```bash
npx @openapitools/openapi-generator-cli@latest generate \
  -i https://petstore.swagger.io/v2/swagger.json \
  -g typescript-axios \
  -o ./src/api/generated-no-comments \
  --additional-properties=withComments=false,modelPackage=models,apiPackage=api \
  --skip-validate-spec
```

### 示例2：生成 React Query 钩子（React 项目带缓存）
```bash
openapi-generator-cli generate \
  -i ./api/swagger.yaml \
  -g typescript-react-query \
  -o ./src/api/generated-react-query \
  --additional-properties=useInfiniteQuery=true,useMutation=true \  # 启用无限查询和变更钩子
  --type-mappings=DateTime=string \                                 # 类型映射（DateTime 转为 string）
```

### 示例3：自定义模板（修改生成代码结构）
```bash
openapi-generator-cli generate \
  -i ./api/swagger.yaml \
  -g typescript-axios \
  -o ./src/api/generated-custom \
  -t ./custom-templates/typescript-axios \  # 本地自定义模板目录（需按官方模板结构编写）
  --config ./openapi-config.json             # 配置文件（统一管理参数，可选）
```

### 示例4：Docker 方式生成（CI/CD 场景）
```bash
docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli generate \
  -i /local/api/swagger.yaml \  # 容器内路径（映射本地 ${PWD} 为 /local）
  -g typescript-axios \
  -o /local/src/api/generated-docker
```

## 五、关键配置参数（`--additional-properties`）
通过 `--additional-properties` 可自定义生成逻辑（多参数用逗号分隔），常用参数：
| 参数名                  | 作用                                  | 示例值                          |
|-------------------------|---------------------------------------|---------------------------------|
| `modelPackage`          | 模型（类型定义）输出目录               | `models`（生成到 `api/models/`） |
| `apiPackage`            | 接口函数输出目录                       | `api`（生成到 `api/api/`）       |
| `moduleName`            | 模块名称（影响导入路径）               | `apiClient`                     |
| `useES6`                | 启用 ES6 语法（如 `import`/`export`）  | `true`                          |
| `supportsES6`           | 支持 ES6+ 特性（如 Promise）           | `true`                          |
| `withInterfaces`        | 生成接口（`interface`）而非类          | `true`                          |
| `enumPropertyNaming`    | 枚举属性命名风格                       | `UPPER_CASE`（大写）、`camelCase` |
| `skipValidatingSpec`    | 跳过规范校验（适配不标准的 OpenAPI 配置）| `true`                          |

## 六、生成代码结构（以 `typescript-axios` 为例）
```
src/api/generated-openapi/
├── api/                  # 接口函数目录（按业务模块拆分）
│   ├── PetApi.ts         # 宠物相关接口（getPetById、createPet 等）
│   ├── StoreApi.ts       # 商店相关接口
│   └── UserApi.ts        # 用户相关接口
├── models/               # 类型定义目录
│   ├── Pet.ts            # Pet 接口、StatusEnum 枚举等
│   └── ...               # 其他模型
├── apiClient.ts          # Axios 实例配置（基础 URL、拦截器等）
├── base.ts               # 基础请求类（封装请求逻辑）
└── index.ts              # 入口文件（统一导出 API 和模型）
```

## 七、项目中使用生成的代码（React 示例）
```tsx
// 1. 导入 API 和模型
import { PetApi, Pet, StatusEnum } from '../api/generated-openapi';

// 2. 初始化 API 实例（可配置基础 URL、拦截器）
const petApi = new PetApi({
  basePath: 'https://your-backend.com/api/v2', // 覆盖默认基础 URL
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}` // 全局 Token
  }
});

// 3. 调用接口
const fetchPet = async (petId: number) => {
  try {
    const pet: Pet = await petApi.getPetById(petId);
    console.log('宠物详情：', pet);
  } catch (error) {
    console.error('查询失败：', error);
  }
};

const createPet = async (petData: Omit<Pet, 'id'>) => {
  try {
    const newPet: Pet = await petApi.addPet(petData);
    console.log('创建成功：', newPet);
  } catch (error) {
    console.error('创建失败：', error);
  }
};
```

## 八、进阶功能：自定义配置文件
创建 `openapi-config.json` 文件，统一管理参数（避免命令行过长）：
```json
{
  "inputSpec": "./api/swagger.yaml",
  "generatorName": "typescript-axios",
  "outputDir": "./src/api/generated",
  "additionalProperties": {
    "modelPackage": "models",
    "apiPackage": "api",
    "useES6": true,
    "withInterfaces": true
  },
  "skipValidateSpec": true,
  "enablePostProcessFile": true
}
```
运行命令时引用配置文件：
```bash
openapi-generator-cli generate --config ./openapi-config.json
```

## 九、常见问题与避坑
1. **“Java 环境缺失”报错**：
   - 原因：使用了 JAR 包方式或旧版 npm 包，依赖 Java 环境；
   - 解决：改用 `@openapitools/openapi-generator-cli`（npm 包），无需 Java 环境。

2. **生成的代码有冗余类**：
   - 原因：默认生成类（`class`）而非接口（`interface`）；
   - 解决：添加参数 `--additional-properties=withInterfaces=true`。

3. **接口路径/参数不匹配**：
   - 原因：OpenAPI 规范不标准，工具校验失败；
   - 解决：添加 `--skip-validate-spec` 参数，跳过规范校验。

4. **导入路径错误**：
   - 原因：`moduleName` 或 `apiPackage` 配置不当；
   - 解决：通过 `--additional-properties` 明确配置包名，确保导入路径正确。

## 十、核心优势与适用场景
### 优势
1. 多语言支持：同一配置可生成 TypeScript、Java、Python 等多语言代码，适配多团队协作；
2. 高度定制化：支持自定义模板、配置文件，可深度调整代码结构；
3. 功能全面：可生成客户端、服务端、文档，一站式解决 API 相关开发需求；
4. 规范兼容：完美支持 OpenAPI 2.x/3.x 全规范，适配复杂场景（多态、鉴别器等）。

### 适用场景
- 多语言协作的大型企业级项目；
- 需同时生成客户端、服务端代码的场景；
- 对代码结构、定制化有强需求的项目；
- CI/CD 自动化生成 API 代码的场景。

## 总结
openapi-generator 是“全能型”工具，前端项目常用 `typescript-axios` 或 `typescript-react-query` 生成器，通过命令行参数或配置文件可灵活定制生成逻辑。相比 openapi-typescript-codegen，它的优势是多语言支持和深度定制化，劣势是上手成本稍高，但对于复杂项目或多团队协作场景，是更优选择。

如需进一步定制模板或集成 CI/CD，可参考官方文档：https://openapi-generator.tech/docs/